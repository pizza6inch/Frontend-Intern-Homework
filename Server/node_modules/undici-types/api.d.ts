import { URL, UrlObject } from 'url'
import { Duplex } from 'stream'
import Dispatcher from './dispatcher'

// An object that exports four functions: request, stream, pipeline, and upgrade
export {
  request, // Performs an HTTP request
  stream, // A faster version of request
  pipeline, // For easy use with stream.pipeline
  connect, // Starts two-way communications with the requested resource
  upgrade, // Upgrade to a different protocol
}

/**
 * Performs an HTTP request.
 * @param url - The URL to make the request to. This can be a string, a URL object, or a UrlObject.
 * @param options - Options for the request. This includes a dispatcher, request options, and an optional method.
 * @returns A Promise that resolves to the response data from the request.
 */
declare function request(
  url: string | URL | UrlObject,
  options?: { dispatcher?: Dispatcher } & Omit<Dispatcher.RequestOptions, 'origin' | 'path' | 'method'> & Partial<Pick<Dispatcher.RequestOptions, 'method'>>,
): Promise<Dispatcher.ResponseData>;

/**
 * A faster version of `request`.
 * @param url - The URL to make the request to. This can be a string, a URL object, or a UrlObject.
 * @param options - Options for the request. This includes a dispatcher and request options.
 * @param factory - A function that creates a stream for the response data.
 * @returns A Promise that resolves to the response data stream.
 */
declare function stream(
  url: string | URL | UrlObject,
  options: { dispatcher?: Dispatcher } & Omit<Dispatcher.RequestOptions, 'origin' | 'path'>,
  factory: Dispatcher.StreamFactory
): Promise<Dispatcher.StreamData>;

/**
 * For easy use with `stream.pipeline`.
 * @param url - The URL to make the request to. This can be a string, a URL object, or a UrlObject.
 * @param options - Options for the pipeline. This includes a dispatcher and pipeline options.
 * @param handler - A function that handles the response data stream.
 * @returns A Duplex stream that can be piped to other streams.
 */
declare function pipeline(
  url: string | URL | UrlObject,
  options: { dispatcher?: Dis
