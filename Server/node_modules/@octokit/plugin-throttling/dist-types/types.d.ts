// Import necessary modules and types
import { Octokit } from "@octokit/core";
import type { EndpointDefaults } from "@octokit/types";
import Bottleneck from "bottleneck";

// Define types for limit handlers and throttling options
type LimitHandler = (retryAfter: number, options: Required<EndpointDefaults>, octokit: Octokit, retryCount: number) => void;
export type SecondaryLimitHandler = {
    onSecondaryRateLimit: LimitHandler;
};
export type ThrottlingOptionsBase = {
    enabled?: boolean;
    // Bottleneck library type
    Bottleneck?: typeof Bottleneck;
    id?: string;
    timeout?: number;
    connection?: Bottleneck.RedisConnection | Bottleneck.IORedisConnection;
    // Deprecated property
    minimalSecondaryRateRetryAfter?: number;
    // Property for fallback retry time
    fallbackSecondaryRateRetryAfter?: number;
    retryAfterBaseValue?: number;
    // Groups for limiting requests
    write?: Bottleneck.Group;
    search?: Bottleneck.Group;
    notifications?: Bottleneck.Group;
    onRateLimit: LimitHandler;
};

// Combine ThrottlingOptionsBase and SecondaryLimitHandler
export type ThrottlingOptions = (ThrottlingOptionsBase & SecondaryLimitHandler) | (Partial<ThrottlingOptionsBase & SecondaryLimitHandler> & {
    enabled: false;
});

// Define a type for groups of Bottleneck limiters
export type Groups = {
    global?: Bottleneck.Group;
    write?: Bottleneck.Group;
    search?: Bottleneck.Group;
    notifications?: Bottleneck.Group;
};

// Define a type for the state object, which includes properties for throttling and groups
export type State = {
    clustering: boolean;
    triggersNotification: (pathname: string) => boolean;
    fallbackSecondaryRateRetryAfter: number;
    retryAfterBaseValue: number;
    retryLimiter: Bottleneck;
    id: string;
} & Required<Groups> & ThrottlingOptions;

// Export an empty object to satisfy the module's export requirements
export {};
