// This is a CircleCI configuration file for a Node.js project.
// It specifies various settings and commands for CircleCI to run.

language: # The language setting specifies the language the project is written in.
  node_js: # This sets the language to Node.js.
    - 8 # This specifies the version of Node.js to use (version 8).

branches: # This section specifies which branches CircleCI should run the configuration on.
  only:
    - master # Only run the configuration on the 'master' branch.
    - next # And also run it on the 'next' branch.

services: # This section specifies any additional services that should be run alongside the project.
  - redis-server # This specifies that a Redis server should be run alongside the project.

env: # This section sets environment variables for the project.
  global:
    - "REDIS_HOST=127.0.0.1" # This sets the Redis host to the localhost.
    - "REDIS_PORT=6379" # This sets the Redis port to 6379.

cache: # This section specifies what should be cached between builds.
  directories:
  - $HOME/.npm # This caches the npm package directory.

install: # This section specifies the commands to run to install the project's dependencies.
- npm i # This runs the 'npm install' command to install the project's dependencies.

sudo: required # This specifies that the 'sudo' command is required for the configuration.

after_success: # This section specifies the commands to run after a successful build.
  - npx codecov --file=./coverage/lcov.info # This runs the 'codecov' command to generate code coverage reports.

script: # This section specifies the commands to run as part of the build.
  npm run test-all # This runs the 'test-all' script specified in the project's 'package.json' file.

before_install: # This section specifies the commands to run before installing the project's dependencies.

